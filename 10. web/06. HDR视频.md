# HDR本意

- High Dynamic Range 高动态范围
  - 动态范围：信号（对于光学系统一般指亮度）最大值和信号最小值的比值
  - HDR视频 =     支持 广色域 + 高动态范围 的视频

# RGB颜色空间的原理

- 光有不同的波长，根据波长不同显示出不同的颜色，理论上通过RGB三种颜色组合，能够组合出全部的色彩空间
- 但是实际上的坐标中，存在需要R为负值的情况【XYZ色彩空间原理】
  - 为什么会出现负值？ 左侧真正的色彩光和右侧的合成光无法一致，这个时候用R照射反射板让左侧颜色变化，从而保证两侧颜色相同。这里红光就被认为是负值。
  - 负值不容易计算？通过矩阵变换，保证RGB都为正数，这就被称为XYZ色彩空间
  - 在XYZ色彩空间中，特定波长的光所产生的颜色，能够形成一条从原点发出的直线 ➡️ 在此基础上，做了一个平面（等边三角形）。不同波长的光在这个平面上的焦点会生成一个马蹄形状。➡️     通过数学运算把这个等边三角形转换成平面直角坐标系，这就是通常使用的“色度图Chromaticity     Diagram”
    - 在这个等边三角形区域中，有X和Y两个值就可以表示出颜色。
    - 其实在等边三角形区域中，还存在Z轴，用于表示亮度。
    - 当设备支持的最大亮度增加时，它能区分出的动态范围也就更大。
    - 基于以上原因，HDR比SDR支持的显示范围更大。HDR意味着更丰富的色彩、更平滑的过度、更多的暗部细节。
  - 色度图是通过数学定义的平面。
    - 色度图上两点连线上的点，代表着通过这两种颜色的不同刺激值形成的新颜色。
    - 如果在色度图上找出RGB三个颜色刺激值对应的点，这三个点形成的三角形，就是通过三原色混合能够产生的所有颜色范围。
    - 一个显示设备能够显示的色彩范围，通常会使用色度图中确定三个顶点包围的区域表示，也被称为**色域**。只需要在色域的基础上定义“白点”的位置，就可以定义一个颜色空间。
  - 视频行业中常见的三种颜色空间标准
    - BT.709                 普通色域
    - Display P3 ( P3D65     )      宽色域
    - BT. 2020     

# 想要支持HDR需要多个部分都支持HDR

- 采集
- 制作
- 传输
  - 上传：用户上传视频（二进制存储的文件）
  - 转码：视频平台转码成不同的分辨率、帧率和编码格式
  - 分发：传输到用户设备上显示出画面
- 播放

# 如何尽可能在人眼不感知的情况下压缩数据

- 人眼对于亮度的区分能力并不是线性的，人眼对于暗光的部分区分能力更强。
  -  若用数字表示亮度，如果用亮度平均的方式编码的话，就会丢失很多深色区域的细节。于是就衍生了Gamma矫正，可以把他理解为显示亮度值是存储值做指数方程后的结果。从而让数字小的地方区分度高，数字大的地方区分度低，从而符合人眼特性。
- 人眼对于颜色不敏感，对于亮度更敏感。 
  - 对于一个RGB矩阵，转换成一个亮度分量和两个色度分量。在存储的时候使用更多的空间存储亮度值，而色度值则分配较少的存储空间，这就是图像的YUV格式（     YCbCr格式）。

# 视频的渲染流程

1. 解码器解压缩 ➡️ 得到一帧帧YUV格式的图片
2. YUV矩阵转换，得到RGB格式
3. RGB格式通过gamma运算，转换为显示用的线性RGB格式
4. 线性RGB通过矩阵运算，转换到与设备无关的XYZ色彩空间

- 注意：在这个过程中，不同组织定义了不同的矩阵参数，从而让视频在不同的系统和设备上能够正确地被播放。这些参数被称为标准。只要一个视频中包含标准所代表的代号，视频播放设备就可以找到对应的转换矩阵或曲线。eg 例如H264编码的视频，通过一些媒体文件分析工具，可以看到编码器在视频中留下的代号，比如转码流程中常用的ffprobe工具
