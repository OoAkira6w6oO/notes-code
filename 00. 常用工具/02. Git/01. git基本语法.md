# 基本介绍

- 分布式版本控制工具

- 为什么需要Git
  从个人开发到多人开发，多个人同时更改一个文件的时候容易发生覆盖

- 集中式版本控制 & 分布式版本控制
  - 集中式
    - 有一个服务器来保存真正的版本
    - 缺点：单点故障
  - 分布式
    - 每个客户端都保存了完整内容
    - 远程库来保证各点的一致性

# 分区思路

## 工作区

- Working Directory / Working Tree
- 当前可编辑文件
- 写代码，代码存放的磁盘位置

## 暂存区

- Staging Area / Index
- 临时存储——临时放置、待提交的文件，负责让git追踪到文件
- 是可以删掉的

## 本地库

- Local Repository
- 历史版本的保存地
- 会生成历史版本 是无法删掉的 因为每一个V2都是基于V1的

## 远程库

- 局域网
  - GitLab
- 互联网
  - GitHub
  - Gitee（China

# 使用

## 用户设置

1. 设置

   ```shell
   git config --global user.name [UserName]
   git config --global user.email [UserEmail] # 虚拟邮箱，不会验证，和远程用户没有任何关系
   ```

2. 查看设置

​	查看User/[user]/.gitconfig文件

## 基本命令

```shell
git init # 初始化，让git获得目录权限。会在相应目录新建一个.git文件
git status
git add # 撤销方法：git rm --cached [file]
git commit -m "[Version Info]" [file Name]

git reflog # 查看精简版本信息
git log # 查看详细版本信息
git diff # 对比
git stash # 暂存当前修改
git stash pop # 恢复stash的修改
```

## 版本穿梭

```shell
git reflog 
git reset --hard [Target Version] # 会在各个等级目录的head文件中存储相关信息
```

## 分支操作

```shell
git branch # 查看本地所有分支
git branch -v <branchName> # 查看指定分支详细信息

git branch <branchName> # 创建新分支
git checkout <branchName> # 切换到已有分支

git checkout -b <branchName> # 创建并切换到新分支 = git branch + git checkout 
git merge <branchName> # 将指定分支合并到当前分支
```

## 别名

```shell
git remote -v # 查看
git remote add [name] [link] # 设置
git push [remoteLib] [branchName] # 推送
```

## SSH

```shell
ssh-keygen -t [加密算法] -C [email]
```

- 参数说明
  - 加密算法：如rsa

  - -C：描述，常用邮箱地址

- 命令运行结果

  - 生成一个公钥(.pub)和一个私钥
  - 公钥需要copy到GitHub上即可

  - 私钥ssh信息会被电脑统一存储到一个.ssh文件夹里

# 团队协作

## 同团队协作

- 设置Collaborators进行团队管理

```shell
git clone # 远程库copy到本地，完整复制
git pull
...
git push
```

## 跨团队协作

-  **Git 托管平台的网页端**（如 GitHub、GitLab、Gitee 等），不是在本地 Git 命令行里完成的

- 操作步骤

  - git fork
    - 不同团队，远程库copy到远程库

  - pull request 
    - 将自己 fork 或本地分支的改动 **申请合并到原远程仓库**
    - 网页端创建 PR
    - 远程库和远程库的合并，申请合并

  - merge pull request
    - 在 PR 被审核通过后，将修改 **正式合并到目标分支**
    - 网页端点击 “Merge pull request” → “Confirm merge”

## PR & MR

- Github上的PR (Pull Request) &  Gitlab上的MR（Merge Request）
- 本质都是“申请合并分支改动”，功能一致
- PR通常涉及 **两个远程库**
- MR通常在 **同一个远程仓库的不同分支**

# Github服务

## 自带个人网站

- 默认初始化名为`[username].github.io`的仓库，是可以通过API访问的一个网站
  - 所创建的Github仓库名，必须和自己的用户名保持一致。
  - 如果提交后看到404页面，操作没问题的话，可以等10分钟后再确认试试。
- 确认服务器可访问
  - Settings / Pages / 找到页面地址

# GitLab

## 特点

- 使用MIT许可证的基于网路的Git仓库管理工具
  - MIT License 是一种 **开源软件许可证**，由麻省理工学院（Massachusetts Institute of Technology）制定
- **GitLab 本身是一个软件平台**，可以部署在公网or局域网上

## 手动搭建GitLab服务器

1. 准备服务器
   - 关闭防火墙
   - 配置主机名和IP
   - 保证服务器可以上网
2. 写脚本安装gitlab
3. 初始化GitLab服务
4. 启动GitLab服务
5. 使用浏览器访问GitLab服务器、设置root账户信息

# 豆-底层思路解读

## Git 和 SVN

- 思路本质不同
  - git是全量管理方案，适用代码、文本
  - svn是增量管理方案，适用大型二进制文件、视频
- 修改信息的存放位置
  - git将修改信息都放在根目录下的.git文件夹中
  - SVN在每一个目录下都有一个.svn，svn想要删除文件的时候就需要删除每一个文件夹中的.svn

## git的全量管理是如何节省空间的

- SHA-1代替重复文件
  - 使用文件的SHA-1值作为文件名进行存储
  - 保证相同内容仅存储一份

- tree结构配合SHA-1
  - 每个文件夹都是一个tree，最底层文件就是一个叶子节点
  - tree左遍历后可以得到扁平化的文件目录
  - 当把文件变成SHA-1值的时候，前两位作为目录名，后面存储子文件信息

## 暂存区的设计

- 可以更好的关注文件状态
  - 有时候你在工作区修改了多个文件，但只想提交其中一部分
  - 避免无关修改被提交
  - 历史记录干净整洁

## 指针 & 快照

- git commit每次会产生一个**快照，对应了一个SHA-1值**
- 多次git commit就会产生一个**快照列表，HEAD指针指向最新的快照**
- Git中的指针
  - 每个版本的指针
  - HEAD指针：最新
