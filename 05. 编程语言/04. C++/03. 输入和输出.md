# 流

## 文本流

- 字符序列

## 二进制流

- 字节序列

## 文件和流

- 文件是逻辑概念，从硬盘到终端的任何东西
- 打开/关闭操作，其实是建立/关闭了文件和“流”的联系
- C++通过流类处理文件输入和输出

# 基本输入输出

## 基本语法

- 头文件
  - "iostream.h"

- 流类
  - istream 输入
  - ostream 输出
  - iostream 输入输出
- 流对象——预先定义好的全局对象
  - cin: 标准输入流
  - cout: 标准输出流（cin和cout可以自动识别变量类型，不需要指定数据类型）
  - cerr: 非缓冲型的标准出错流
  - clog: 缓冲型的标准出错流

- 运算符

  - 提取运算符 >> 进行输入
    - 回车分割元素

  - 插入运算符 << 进行输出
    - 根据类型自动显示数据

```C++
#include <iostream.h>
void main( )
{   
  int dt;
   char ss[80];
   cout << “Input data: ”;
   cin >> dt;
   cout << “Data is [” << dt << “]\n”;
   cout << “Input String: ”;
   cin >> ss;
   cout << “String is [” << ss << “]\n”;
 }
```

## 成员函数（流的内部函数）

### 基本函数

- width() 
  - 指定域宽，每次输出完会被重置
- fill() 
  - 表示不足的位置填充指定字符
- precision() 
  - 指定精度
- flush() 
  - 刷新缓冲区

### 字符处理

- get()
- put()

### 字符串处理

- get()
  - istream& get(char *ss, int count, char delim=‘\n’);
  - 不读入由delim标识的区分字符（读取并丢弃）
  - ss：缓冲区指针
    count：最多向ss存入count个字符
    delim：如果遇到此字符，输入结束——默认是换行符
- getline()
  - istream& getline(char *ss, int count, char delim=‘\n’); 
  - 读入由delim标识的区分字符 （读取）

```C++                   
char ch;
cin.get(ch);//出错返回null，否则返回this指针
//每输入一个字符按一下回车，最后结束时按ctrl+z即可（代表end of file）
cout.put(ch);
```

## 标准库全局函数

- “I/O 流操纵符”，本质是全局函数（通常是内联函数）
  - 返回流对象引用
  - 可作用于任意流对象，语法更自然
  - 可以进行链式调用

- 进制处理
  - oct 八进制，dec十进制，hex十六进制
  - cout << hex << 255; 等价于hex(cout) << 255;
- ws 
  - 输入跳过空格
- fulsh 
  - 刷新缓冲区
- endl 
  - 输出时追加\n并刷新缓冲区//end line
- ends 
  - 输出时追加\0并刷新缓冲区//end string

```C++
count.width(10);
count.width(0);//手动清除
count.fill('#');
cout.precision(5);
cout.flush();

cin.tie(&cout);//每次调用 cin 进行输入操作前，系统会自动刷新（flush）cout 的缓冲区；通常没有必要显式写出

count<<dec<<dt<<'\n';
```

# 文件输入输出

## 基本语法

- 头文件 
  - fstream.h
- 流类
  - ifstream 输入
  - ofstream 输出
  - fstream  输入输出

- openmode
  - ios::in 输入方式，default值
  - ios::no create 不存在不创建，直接报错
  - ios::binary 二进制方式

## 打开文件

```C++
//打开文件
void open(const char *fname, int  
   openmode=ios::in, int prot=filebut::openprot); 
//  fname：指向文件名的指针；
//  openmode：打开模式；
//  prot：打开文件的保护种类(一般采用缺省值)。


//1. 基本写法
ifstream fin;           //定义输入用对象
fin.open("datafile.txt");  //打开datafile.txt文件

//2. 在定义输入用对象的同时打开文件
ifstream fin(“datafile.txt”); 

//3. 利用fstream类来打开输入/输出用文件
fstream file(“INOUT”, ios::in|ios::out);
```

## 操作文件流

```C++
 ifstream fin;
 ofstream fout;
 char ch;
     ……
 fin.open(“mydata1.txt”);    //打开输入用文件
 fout.open(“mydata2.txt”);  //打开输出用文件
     ……
 fin.get(ch);              //或   fin >> ch;
 fout.put(ch);            //或   fout << ch;
     ……
 fin.close( );              //关闭输入文件
 fout.close( );            //关闭输出文件

```

## 手动操作文件指针

- 输出时
  - seekp()  // p = put pointer
  - tellp()
- 输入时
  - seekg() // g = get pointer
  - tellg()

```C++
fout.seekp(100L);//设置指针位置
fin.seekg(200L);//得到输入流的指针位置
```

## 错误处理

| 成员函数  | 意义             |
| --------- | ---------------- |
| good()    | 正常             |
| bad()     | 重大输入输出错误 |
| fail()    | 可恢复的error    |
| eof()     | 文件结束         |
| rdstate() | 返回错误标志     |

- 错误标志
  - ios::goodbit   无错
  -  ios::eofbit     到达文件尾部
  - ios::failbit  发生可以恢复的格式错或变换错
  -  ios::badbit 发生重大错或未知状态

```C++                   
if(fin.fail( ));      //如果出错（简写为：if(!fin)） 
if(!fin.good( ));     //如果出错
```

## 代码举例

```C++                   
//通过命令行参数来获取输入文件名，而当命令行上无文件名参数时，将给出程序用法提示信息。
#include<iostream.h>
#include<fstream.h>
int main(int argc, char *argv[]){
  char ch;
  if(argc != 2){
    cout << "Usage: PR<filename>\n";
    return 1;
  }
  
  ifstream in(argv[1]);
  if(in.fail()){
    count << "Cannot open file\n";
    return 1;
  }
  while(!in.fail()){
    in >> ch;
    cout <<ch;
  }
  in.close();
  return 0;
}
```

