# 编译预处理命令

- 告诉编译器，在正式编译之前，应该对源程序进行那些操作
- C语言编译系统的组成部分
- 分类
  - 宏定义
  - 文件包括
  - 条件编译
- 与一般语句区别，所有的预处理命令都以 `#` 开头

# 宏定义 define

## 基本介绍

- macro
- 本质
  - 文本替换 / 代码生成
  - 只是进行 文本替换，不会进行类型检查
- 和函数对比
  - macro在 预处理 / 编译 阶段展开
  - 如果是func，在运行阶段才调用
- 作用域
  - 全局可见，不存在作用域的概念
- 注意
  - 如果使用太多，目标代码会在替换后变得很长
  - 只用于表示一些简单的表达式

## 符号常量定义

- 定义常量，使得更容易明白常量的意义
- 语法
  -  #define  [符号常量名] [字符串] 
  - **结尾没有分号**，否则分号也会被看作字符串的一部分
  - 常量名**习惯使用大写字母**
- 宏展开
  - 在编译阶段，重新将符号变量名，展开为字符串
- lib中的使用
  - NULL是在stdio.h文件中定义的符号常量，其基本定义如下
  - #define NULL 0

```C
#define ESC 0x1B
//当编码值变化时，仅需修改宏定义语句即可
```

## 带参数的宏定义

- 语法
  -  #define [宏名(参数表)] [字符串]
- 注意
  - 使用时，字符串和参数表都要用括号括起来，
    否则展开后可能因为运算优先级有一些意想不到的错误发生



```C
#define PI 3.1416
#define AREA(r) (PI*r*r)

float S = AREA(3);
//如果宏带参数，会进行包括参数的替换
```

## undef命令

- 语法
  - #undef 标识符
- 作用
  - 将已经定义的标识符变为未定义的


## 和typedef的转换

- typedef  int TINT;
  - 不可以扩展
- #define MINT int
  - unsigned MINT x;  //可以扩展

# 文件包括 include

- 一个源文件引入另一个源文件
- 语法
  - #include <文件名>
    - 完全跳过当前目录
    - 从 系统标准包含路径（如 /usr/include、编译器自带的库路径）开始查找。
    - 引入系统头文件或库头文件
  - #include "文件名"
    - 优先在文件所属目录中开始寻找
    - 如果找不到，再去 系统标准包含路径 查找
  - **""的查找范围 = <>的查找范围 + 当前目录**
- 头文件

  - 以`.h`为扩展名
  - 头文件本质上就是普通的源代码文件
  - 通常不直接定义函数体
  - 通常包含：
  - define 多种
      - 符号常量（#define 或 const）
    - 宏定义（带参数的 #define）
    - extern 声明
    - extern函数声明（extern 或普通声明）
      - 全局变量声明（extern）
  - struct 结构体/类声明
- 使用注意

  - include的本质是文本替换，所以a文件变化后，所有include了a的文件都应该重新编译

```C
#include "stdio.h"//标准输入输出
```

# 条件编译

## 功能

- 使同一源代码，在不同编译条件下，能够产生不同的目标代码文件

## ifdef

```C
#ifdef 标识符
	xxxxA
#else
  xxxxB
#endif
//如果标识符已经定义过，则使用xxxxA，否则xxxxB
```

## ifndef

```C
#ifndef 标识符
	xxxxA
#else
  xxxxB
#endif
```

## if

```C
#if 表达式
	xxxxA
#else
  xxxxB
#endif
//表达式本身会在编译阶段求
```

### 和if语句的区别

- 一旦语句不参与编译，就不会在目标程序中留下对应的代码
- if一定会在目标程序中留下对应的代码

## 应用场景

```C
//eg1. 根据计算机位数进行不同编译
#ifdef NEC_PC
#define INT_SIZE 16
#else
#define INT_SIZE 32
#endif

#define NEC_PC 1


//eg2. DEBUG输出记录
#ifdef DEBUG
printf("X=%d,Y=%d", x, y);
#endif

#define DEBUG

//eg3. #if
#define FLAG 1
      
#if FLAG
    x=1;
#else
    x=0;
#endif

```

