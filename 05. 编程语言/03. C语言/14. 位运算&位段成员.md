# 位运算

- 对二进制位进行运算

# 运算rule

- 最右边的是第0位，往左递增
- 运算对象的限制
  - int
  - short int
  - unsigned int
  - long int
  - char
  - 不可以是浮点型
- 运算原则
  - 如果两个数据位数不同，会右端对齐，左补符号位

| 运算符 | 含义 |
| ------ | ---- |
| &      | 与   |
| \|     | 或   |
| ^      | 异或 |
| ~      | 取反 |
| <<     | 左移 |
| >>     | 右移 |

# 应用场景

- 将指定位清0
- 取出指定位
- 更改指定位
- 取反指定位
- 快速x2
- 快速/2

# 位段

- **位段**——位运算结合struct的应用
  - 节省存储空间的做法，声明每一个变量占据的bit
  - struct里包含 普通成员、位段成员
  - 位段成员必须是unsigned或int
- 注意
  - **不能用 & 获取位段地址**，因为位可能在字节内部
  - 位段不能说明为数组
  - 在位段结构定义中，**可以包含非位段成员（会在新字节开始存储）**
  - 可以被强制转换成一般类型

```C
//一个 8 位寄存器，其中每个位有不同功能
struct Register {
    unsigned int flag1 : 1;//flag1就是一个位段成员
    unsigned int flag2 : 1;
    unsigned int mode  : 2;//也可以是无名位段，省略mode，这样就只作为分割作用存在2位
    unsigned int unused: 4;
};

x=data.f4+2*data.f3-3;
//位段可以在一般的表达式中被引用，并被自动转换为相应的整数
```

