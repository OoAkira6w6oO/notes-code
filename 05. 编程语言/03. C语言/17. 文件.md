# 文件

- **外存储器**上的数据的集合
- 文件根据**存储形式**进行分类
  - ASCII文件
    - 文本文件
    - 以 **字符的形式** 保存数据
    - 3.1416 = 6个字符 = 6个字节
    - 人类直接能看懂
  - 二进制文件
    - 和内存中表现相同
    - 3.1416f = 1个float = 4个字节

# 文件处理方式

- C语言编译系统提供了两种文件处理方式
  - 有缓冲区的“缓冲文件系统”，指针访问
  - 自定义缓冲区的"非缓冲文件系统"，文件号访问

- 处理方式对比
  - 处理**速度**：非缓冲文件系统 > 缓冲文件系统
  - 缓冲文件系统 是在"非缓冲文件系统"基础上实现的
  - “非缓冲文件系统 ”提供的操作依赖于OS，应该**优先使用“缓冲文件系统 ”**

# 缓冲文件系统

## 特点

- 高级文件系统
- 开辟一个内存上的缓冲区，输入和输出；缓冲区每次满了才写入磁盘
- `stdio.h` 中的函数内部有 **系统自动管理的缓冲区**（buffer）
- 文件标识 = “文件类型指针”
  - **FILE *fp;** //FILE结构类型在stdio.h头文件中定义

## 文件的使用方式

| 代码  | 方式                                                         |
| ----- | ------------------------------------------------------------ |
| r     | 只读                                                         |
| w     | 覆盖写                                                       |
| a     | 追加写                                                       |
| r+    | 读写，文件必须 **已经存在**                                  |
| w+    | 读写，会覆盖文件并新建                                       |
| a+    | 读+追加                                                      |
| ....b | 上述文件使用方式上附加字母“b”，则是以同样的方式打开二进制文件 |

## 文件位置的标志

| 标志             | 意思         |
| ---------------- | ------------ |
| EOF(End of File) | 结尾         |
| SEEK_SET         | 文件开头     |
| SEEK_CUR         | 文件当前位置 |
| SEEK_END         | 文件结尾     |

## 常见读写函数

| 函数   | 使用                            |
| ------ | ------------------------------- |
| fopen  | fp = fopen("edit.txt", "r+");   |
| fclose | fclose(fp);                     |
| fgetc  | char c = fgetc(fp);             |
| fread  | fread(buffer,size,count,fp);    |
| fscanf | fscanf(fp,"%d,%f,%d",&a,&f,&b); |
| fputc  | fputc(c,fp);                    |
| fwrite | fwrite(buffer,size,count,fp);   |
| fprint | fprintf(fp,"%d%f",a,b);         |

## 常见定位函数

| 函数   | 使用                              |
| ------ | --------------------------------- |
| rewind | rewind(fp); //移动到开头          |
| fseek  | fseek(fp,100L,SEEK_CUR);          |
| ftell  | fpos=ftell(fp);//返回当前读写位置 |

## 代码

```C
//从fp所指定的文件中读入4个整型数据
int x[4];
fread(x,2,4,fp);//第2个参数2是指一个整型数占2个字节，所读入的数据将存放到x数组

//将x数组中的5个浮点型数据输出到磁盘文件
float x[5]={1.1,2.2,3.3,4.4,5.5};
fwrite(x,4,5,fp);//第2个参数4是指每个浮点型数据占4个字节

```

# 非缓冲文件系统

## 特点

- 低级文件系统
- 更接近于操作系统
- 没有自动缓冲区，程序员必须自己决定缓冲区大小，并自己管理
- 使用 `unistd.h` 或 `fcntl.h` 中的函数，比如 `open`、`read`、`write`、`close`

- 文件标识 = 文件号
  - int fs;

## 文件的使用方式

| 标志     | 意思 |
| -------- | ---- |
| O_RDONLY | 只读 |
| O_WRONLY | 只写 |
| O_RDWR   | 读写 |

## 常见函数

| 函数   | 功能                                |
| ------ | ----------------------------------- |
| open   | int fd=open("file",O_RDWR);         |
| create | fd=creat("file1",O_RDWR)；          |
| close  | close(fd);                          |
| read   | read(fd,buffer,count);              |
| write  | write(fd,buffer,count);             |
| lseek  | lseek（文件号，偏移量，起始位置）； |
| tell   | long int lpos=tell(fd);             |

## 代码

```C
//从指定文件中读入10个字符并存入到字符数组a中
char a[10];
read(fd,a,10);

//把a数组中的10个字符输出到指定文件中
static char a[11]={"ABCDEFGHIJ"}；
write(fd,a,10);

```

