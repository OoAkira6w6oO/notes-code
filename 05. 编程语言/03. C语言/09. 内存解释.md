# 存储空间的分类

- 程序区
  - 可执行的机器指令
- 静态存储区
  - 需要占用固定存储单元的变量
- 动态存储区 Heap
  - 不需要占用固定存储单元的变量

# 变量的作用域

## 局部变量

- 作用域仅仅局限于定义它的函数

## 全局变量

- 在函数外部定义的变量
- 作用域：从它定义的位置开始到**本源文件**的结束
- 存储类别
  - 静态存储区

## 区分

- 同名优先级：局部变量 > 全局变量

# 变量的存储类别

- 基本分类
  - 自动类(auto)变量
  - 静态类(static)变量
  - 寄存器类(register)变量
- extern 链接类型

## 静态的static

- 定义
  - static float f;
  - static int i；
- 作用域
  - **限制仅作用于此文件中**
  - 从定义位置到文件的结束
- 内存
  - 静态存储区
- 特点
  - 值并不消失，其值能够保持连续性
  - 静态局部变量是在编译过程中赋初值的
  - 只赋一次初值，在程序运行时其初值已经确定（默认初值为0）

## auto 自动类

- 定义
  - auto float f; //默认，所以可以省略
- 内存
  - 动态存储区——结束后释放
- 初始化
  - 每调用一次函数时都赋一次初值，且自动类变量的默认**初值不确定**

## register寄存器类

- 定义
  - register int n

- 特点
  - 提高某些 variable / function形参 的存取速度
  - 实际可用的寄存器变量的`个数`：受机器硬件特性的限制
  - 数据类型限制
    - 能够说明为寄存器类变量的数据类型只有char、short int、unsigned int、int和指针型等
    - auto variable / function形参
    - 不能将static静态变量 / 全局变量说明为寄存器类

## 外部的extern

### 知识

- 定义
  - extern int x;
  - 没有声明为static的全局变量
- 特点
  - 表示这个变量在别的文件里已经定义过了，这里只是声明一下。
  - 默认函数声明就是 `extern` 的
  - **本身不分配存储空间，而是说明符号在别处定义，改变的是“链接属性”**

### extern代码举例

- file1.c

```C
#include <stdio.h>

int g1 = 10;          // 普通全局变量（外部链接，可以被别的文件使用）
static int g2 = 20;   // 静态全局变量（只在 file1.c 内可见）

void func1(void) {
    static int count = 0;  // 局部静态变量（func1 函数体内可见）
    int temp = 0;          // 普通局部变量（func1 函数体内可见）
    count++;
    temp++;
    printf("func1: count=%d, temp=%d\n", count, temp);
}

void func2(void) {
    printf("func2: g1=%d, g2=%d\n", g1, g2);
}

```

- file2.c

```C
#include <stdio.h>

extern int g1;   // 声明 g1 在别处定义（这里不分配存储）

void func3(void) {
    printf("func3: g1=%d\n", g1);
}
```

- main.c

```C
#include <stdio.h>

// 函数声明
void func1(void);
void func2(void);
void func3(void);

int main(void) {
    func1(); // 第一次调用
    func1(); // 第二次调用
    func2(); // 访问 file1.c 的 g1 和 g2
    func3(); // 访问 file1.c 的 g1
    return 0;
}
```

- 编译和链接命令

```shell
gcc main.c file1.c file2.c -o program
```

- 编译器先生成：

  - `main.o`

  - `file1.o` （里面有 g1 的定义）

  - `file2.o` （里面有 g1 的未定义引用）

​	然后链接器把它们合并，最终生成 `program`。

# 函数的存储类别

## 内部函数

- 只能在定义它的文件中被调用
- static关键字
- 定义
  - static float act(int a, int b){}


## 外部函数

- 非static声明的都是外部函数
- 可以明确用extern关键字说明，定义的时候可以省略，但是引用外部函数的时候不可以省略

```C
//f1.c文件中的内容为：
 void main( )
 {    
   		extern void input(char [ ] );//外部函数声明
      char buff[100];
      …
      input(buff);
      …
 }

//f2.c文件中的内容为：
extern void input(char b[100])//extern可以去掉
{
       …
}
```

